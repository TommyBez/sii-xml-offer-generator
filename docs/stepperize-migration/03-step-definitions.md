# 03 ‑ Step Definitions

At the core of Stepperize is the **step declaration**.  Each step is a plain object that *must* have an `id` and can optionally contain metadata like `label`, `schema`, or anything of your choosing.

```ts
// lib/stepper.ts
export const { useStepper, steps, utils } = defineStepper(
  /*  ┌───────── id (canonical) */
  /*  │    ┌──── label (UI) */
  { id: 'identification', label: 'Identification', schema: identificationSchema },
  { id: 'offer-basic',    label: 'Basic Info',     schema: offerBasicSchema },
  { id: 'offer-details',  label: 'Offer Details',  schema: offerDetailsSchema },
  // … repeat for all 30+ steps …
);
```

> **Golden rule:** *Never* derive step ID strings via string concatenation; always reference the `id`.​

---

## 3.1  Naming Convention
* use **kebab-case** for `id`.  
* Keep `label` human-readable (will appear in tooltips & mobile nav).  
* Append suffixes like `-optional` / `-summary` only when truly needed – avoid bloating the ID set.

---

## 3.2  Schema Association
`schema` should point to the **Zod schema** used by the corresponding form.  This enables two features:
1. RHF resolver selection:
   ```ts
   const form = useForm({ resolver: zodResolver(stepper.current.schema) });
   ```
2. Programmatic validation (e.g., batch validation in the Review step):
   ```ts
   await stepper.utils.forEach(async (step) => {
     const result = await step.schema.safeParseAsync(formData[step.id]);
     metadata[step.id].hasErrors = !result.success;
   });
   ```

If a step does **not** have a form (e.g., `summary-review`) simply omit `schema`.

---

## 3.3  Autogenerated `StepId` Type
In `lib/stepper.ts` add:
```ts
type StepId = typeof steps[number]['id'];
export type { StepId };
```
Now the entire codebase can rely on the **union** of all IDs, making `goTo()` calls type-safe:
```ts
const goToDetails = () => stepper.goTo('offer-details' satisfies StepId);
```

---

## 3.4  Utility Helpers
Stepperize exposes `utils` for quick queries – we re-export these for convenience.
```ts
// lib/stepper.ts
export const getIndex     = utils.getIndex;      // (id) -> number
export const isFirstIndex = (id: StepId) => getIndex(id) === 0;
```

These helpers replace the custom functions found in `wizard-config.ts` (`getStepById`, `getStepIndex`, etc.).

---

## 3.5  Adding / Removing Steps
1. Update `defineStepper(...)`.  
2. Create / remove the corresponding **form page** in `components/forms/`.  
3. Link the page inside `app/(wizard)/...` route (if using file-system routing).  
4. Update conditional logic in `step-conditions.ts` if the new step affects visibility.

> **Note**: The order of parameters in `defineStepper()` **defines the canonical flow**.  To rearrange steps, simply change the ordering – no other code changes required.

---

**Read next:** [04-Metadata Strategy](./04-metadata-strategy.md) 